// -----------------------------------------------------------------
//	CONTRACT:  KSRTLA--DiveTest - KUMA - KUMA - Dive Certification tests
//	Author: Caerfinon 
// -----------------------------------------------------------------

CONTRACT_TYPE
{
//CONTRACT DESCRIPTION
	sortKey = KSRTLA-KUMA-00
	name = KSRTLA-DiveTest
	title = KUMA Dive Certification tests
	group = KUMA
	agent = KUMA

	description = Gus Kerman wants to augment our abilities in ocean recovery operations. He wants us to complete Dive Certification training as a start to our entry into Oceanography. An inspector from the KUMA (Kerbal Undersea Marine Agency) is waiting to give us a certification test before we can begin work in Kerbin's oceans.
	genericDescription = Gus Kerman want to begin advanced ocenaography missions based at the Kerbal Space Center
	synopsis = Take the KUMA inspector on a trial voyage to get dive certifications completed. 
	//notes = test
	completedMessage = You have successfuly completed KUMA certification and you are approved for undersea operations. 

//Contract Limits
	maxCompletions = 1
	maxSimultaneous = 1
	autoAccept = false
	declinable = true
	cancellable = true
	minExpiry = 0.0
	maxExpiry = 0.0
	deadline = 0

//Contract Reward Modifiers
	prestige = Trivial
	targetBody = Kerbin
	
//Contract Rewards
	advanceFunds = 1000
	rewardFunds = 4000
	rewardReputation = 1
	rewardScience = 0

//Contract Penalties
	failureFunds = 5000
	failureReputation = 5
	
// -----------------------------------------------------------------	
// REQUIREMENTS FOR CONTRACT TO APPEAR
// -----------------------------------------------------------------	
//

// Comment about requirement
	REQUIREMENT
	{
		name = PartUnlocked
		type = PartUnlocked
		part = MK1CrewCabin
	}

// -----------------------------------------------------------------	
//DATA NODES TO PROCESS FOR CONTRACT USE
// -----------------------------------------------------------------

//Contract Specific VesselParameterGroup Definition Key (to prevent conflict with other active contracts)
	DATA
	{
		type = string
		craftEVA = KSRTLA-DiveTestEVA
	}

	
// Randomly select 0 (male) or 1 (female)
	DATA
	{
		type = int
		obsGenderType = Random(0,1)
	}
	
	DATA
    {
        type = bool
        obsIsFemale = @/obsGenderType == 1
    }


// Create KUMA Inspector	
	DATA
	{
		type = string
		
		ObserverRank = "Insp. "
		ObserverKerbal1 = @ObserverRank + RandomKerbalName(@/obsIsFemale ? Female : Male)
		
		hidden = true
		
	}	
	
	DATA
	{
		type = List<Kerbal>
		
		kerbalsKUMAObserver = [ NewKerbal( @/obsIsFemale ? Female : Male, @/ObserverKerbal1 , "Civil-Servant" ) ]
		
		hidden = true
		
	}


// -----------------------------------------------------------------
//BEHAVIOURS TO DO WHEN CREATING CONTRACT
// -----------------------------------------------------------------
//

		
// Spawn the observer
	BEHAVIOUR
	{
		name = SpawnPassengers
		type = SpawnPassengers
		kerbal = @/kerbalsKUMAObserver.ElementAt(0)
		kerbalType = Unowned
		removePassengers = true
	}

//Remove the survivors when the contract completes
	BEHAVIOUR
	{
		name = RemoveKerbal
		type = RemoveKerbal
		kerbal = @/kerbalsKUMAObserver.ElementAt(0)
	}

	BEHAVIOUR
	{
		name = WaypointGenerator
		type = WaypointGenerator
		
		// Start and End location
		WAYPOINT
		{
			name = @KSRTLA:HarbourFullName.ElementAt(0)
			targetBody = @/targetBody
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/port
			altitude = 0
			latitude = @KSRTLA:HarbourLAT.ElementAt(0)
			longitude = @KSRTLA:HarbourLON.ElementAt(0)
		}
		
		
	    RANDOM_WAYPOINT_NEAR
		{
			name = the Dive Test site
			icon = ContractPacks/KerbinSideRemasteredTLA/Assets/Icons/dive
			targetBody = @/targetBody
			nearIndex = 0
			minDistance = 20000.0
			maxDistance = 25000.0
			underwater = true
			altitude = -0.1
		}
	}

// Mission Dialog boxes
	BEHAVIOUR
	{
		name = DialogBox
		type = DialogBox

		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = LaunchSite
			
			position = CENTER
			
			TEXT
			{
				text = Best of luck with your KUMA certification. So get your feet wet and do us proud. A whole new avenue of exploration and more importantly part recovery is ours for the taking. Dive safe.
				fontSize = 20
				textColor = #BADA55
			}
			
			INSTRUCTOR
			{
				name = Strategy_MechanicGuy
				showName = true
				textColor = #BADA55
				animation = true_thumbsUp
			}
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = ReturnToPort
			
			position = CENTER
			
			TEXT
			{
				text = This is wonderful! Congratulations on completing your dive tests and returning to tell the tale. A whole world of undersea exploration is now available to use. Good Job.
				textColor = #BADA55
			}
			
			INSTRUCTOR
			{
				name = Strategy_MechanicGuy
				showName = true
				textColor = #BADA55
				animation = true_thumbsUp
			}
			
		}
		
// failed misssion dialog
		DIALOG_BOX
		{
			condition = CONTRACT_FAILED
			position = CENTER
			title = <b>Sometimes Things Go Wrong</b>
			titleColor = #B00B1E
			
			TEXT
			{
				text = KUMA RREPORT: A KSP experimental vessel conducting dive certification testing near the Kerbal Space Center has had an accident. KUMA wishes to express our deepest sympathies to the families and friends of the lost crew. 
				fontSize = 20
				textColor = #B00B1E
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredTLA/Assets/Flags/KUMA 
				characterName = Kebin Undersea Marine Agency
			}
		}
	}


// -----------------------------------------------------------------
//PARAMETERS FOR CONTRACT COMPLETION
// -----------------------------------------------------------------
//
//Spawn the Inspector at a launch site
	PARAMETER
	{
		name = HasPassengers
		type = HasPassengers
		title = load the Kuma Inspector from your initial launch site
		notes = The insppector can be launched from any launch site and transported to the expedition vessel at the port
		hideChildren = true
		kerbal = @/kerbalsKUMAObserver.ElementAt(0)
		completeInSequence = true
	}
	
//Launch Site
	PARAMETER
	{
		name = LaunchSite
		type = All
		title = begin your journey at the @KSRTLA:HarbourFullName.ElementAt(0)
		notes = Your vessel must be within 500 meters of the port maker
		completeInSequence = true
		disableOnStateChange = true

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a certified pilot
			trait = Pilot
			minCrew = 1
			disableOnStateChange = false
			completeInSequence = true
			hideChildren = true
		}
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a certified engineer
			trait = Engineer
			minCrew = 1
			disableOnStateChange = false
			completeInSequence = true
			hideChildren = true
		}
			
		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = The KUMA Inspector is on board
			hideChildren = true
			kerbal = @/kerbalsKUMAObserver.ElementAt(0)
			completeInSequence = true
			disableOnStateChange = false
		}
		
		PARAMETER
		{
			name = ReachState
			type = ReachState
			title = your vessel is at a stop	
			targetBody = Kerbin
			situation = SPLASHED
			maxSpeed = 5
			minAltitude = -5
			disableOnStateChange = false
			completeInSequence = true
			hideChildren = true
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0
			distance = 500
			hideOnCompletion = false
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
		}
	}
	
	PARAMETER
	{
		name = All
		type = All
		title = sail to the Dive Test site
		completeInSequence = true
		disableOnStateChange = true

		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = The KUMA Inspector is on board
			hideChildren = true
			kerbal = @/kerbalsKUMAObserver.ElementAt(0)
			disableOnStateChange = false
		}

		PARAMETER
		{
			name = the Test Area
			type = VisitWaypoint
			title = approach within 200 meters of the dive marker
			index = 1
			distance = 200
			showMessages =  true
			hideOnCompletion = true
			hideChildren = true
			disableOnStateChange = false
		}		

		PARAMETER
		{
			name = ReachState
			type = ReachState
			title = and bring your vessel to a stop	
			targetBody = Kerbin
			situation = SPLASHED
			maxSpeed = 5
			minAltitude = -5
			disableOnStateChange = false
			hideChildren = true
		}
	}
	
	
	// Test 1 submerge to 200 meters below sea level
	PARAMETER
	{
		name = All
		type = All
		title = submerge your vessel test
		completeInSequence = true
		disableOnStateChange = true

		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = The KUMA Inspector is on board
			hideChildren = true
			kerbal = @/kerbalsKUMAObserver.ElementAt(0)
			disableOnStateChange = false
		}
		
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a certified pilot
			trait = Pilot
			minCrew = 1
			disableOnStateChange = false
			hideChildren = true
		}
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a certified engineer
			trait = Engineer
			minCrew = 1
			disableOnStateChange = false
			hideChildren = true
		}
		
		PARAMETER
		{
			name = ReachState
			type = ReachState
			title = to a depth of at least 200 meters below sea level
			targetBody = Kerbin
			situation = SPLASHED	
			maxAltitude = -200
			minAltitude = -1500
			disableOnStateChange = false
			hideChildren = true
		}
	}

	// EVA Scuba test
	PARAMETER
	{
		name = All
		type = All
		title = perform the Scuba test
		completeInSequence = true
		disableOnStateChange = true
			
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = the diver must be an engineer
			trait = Engineer
			minCrew = 1
			disableOnStateChange = false
			hideChildren = true
		}
		
		PARAMETER
		{
			name = ReachState
			type = ReachState
			title = descend to a depth of at least 300 meters below sea level and stop
			targetBody = Kerbin
			situation = SPLASHED	
			maxSpeed = 0.0			
			maxAltitude = -300
			minAltitude = -1500
			hideChildren = true
			disableOnStateChange = true
		}		

		PARAMETER
		{
			name = CollectScience
			type = CollectScience
			title = take an EVA Report (1)  
			targetBody = Kerbin
			experiment = evaReport
			recoveryMethod = None 
			disableOnStateChange = true
		}
		
	}

	PARAMETER
	{
		name = ReturnToPort
		type = All
		title = Retrive your diver and return to @KSRTLA:HarbourFullName.ElementAt(0)
		disableOnStateChange = true
		completeInSequence = true
		
		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = The KUMA Inspector is on board
			hideChildren = true
			kerbal = @/kerbalsKUMAObserver.ElementAt(0)
			disableOnStateChange = false

		}
		
		PARAMETER
		{
			name = The port
			type = VisitWaypoint
			title = approach to within 500 meters of the port marker
			index = 0
			distance = 500
			showMessages =  true
			disableOnStateChange = false
		}

		PARAMETER
		{
			name = ReachState
			type = ReachState
			title = and stop your vessel
			targetBody = Kerbin
			situation = SPLASHED
			maxSpeed = 5.0
			minAltitude = -5
			disableOnStateChange = false
			hideChildren = true
		}
	}
	
	PARAMETER
	{
		name = All
		type = All
		title = safely
		completeInSequence = true
		disableOnStateChange = true
		
		PARAMETER
		{
			name = KerbalDeaths
			type = KerbalDeaths
			title = without killing the KUMA Inspector
			kerbal = @/kerbalsKUMAObserver.ElementAt(0)
		}
	}
	
//Recovery Parameter - Recover Kerbals
	PARAMETER
	{
		name = RecoverKerbal
		type = RecoverKerbal
		title = and recover the KUMA Inspector
		kerbal = @/kerbalsKUMAObserver.ElementAt(0)
		completeInSequence = true		
		hideChildren = true
	}

// -----------------------------------------------------------------
// END OF CONTRACT
// -----------------------------------------------------------------
}



	



	